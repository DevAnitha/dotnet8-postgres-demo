-- ============================================================
-- One Stop / Separation tables (based on the spreadsheet design)
-- Target: PostgreSQL
-- Notes:
--  - All tables are created in schema: onestop (adjust if needed)
--  - record_status_id FKs are NOT added here (since lookup table not shown)
--  - core_identity FK targets are commented (since that table/schema isnâ€™t shown)
-- ============================================================

create schema if not exists onestop;

-- Optional: make onestop the default for this session
-- set search_path to onestop, public;

-- ============================================================
-- 1) LOOKUP TABLES
-- ============================================================

create table if not exists onestop.separation_type (
  separation_type_id   int generated by default as identity primary key,
  separation_type_name text not null,
  sort_order           int,
  record_status_id     int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text
);

create table if not exists onestop.separation_status (
  separation_status_id   int generated by default as identity primary key,
  separation_status_name text not null,
  sort_order             int,
  record_status_id       int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text
);

create table if not exists onestop.one_stop_checklist_statuses (
  one_stop_checklist_status_id   int generated by default as identity primary key,
  one_stop_checklist_status_code text not null,
  one_stop_checklist_status_name text not null,
  sort_order                      int,
  record_status_id                int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text
);

create table if not exists onestop.one_stop_offices (
  one_stop_office_id   int generated by default as identity primary key,
  one_stop_office_name text not null,
  sort_order           int,
  record_status_id     int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text
);

create table if not exists onestop.one_stop_office_items (
  one_stop_office_item_id   int generated by default as identity primary key,
  one_stop_office_id        int not null,
  one_stop_office_item_name text not null,
  control_type              text,   -- ex: 'radio', 'checkbox' (no constraint added so you can extend later)
  sort_order                int,
  record_status_id          int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text,

  constraint fk_one_stop_office_items_office
    foreign key (one_stop_office_id)
    references onestop.one_stop_offices(one_stop_office_id)
);

create index if not exists ix_one_stop_office_items_office_id
  on onestop.one_stop_office_items(one_stop_office_id);

-- ============================================================
-- 2) TRANSACTION TABLES
-- ============================================================

create table if not exists onestop.separation_initiation (
  separation_initiation_id int generated by default as identity primary key,

  core_identity_id     int not null,  -- fk
  last_day             date,
  separation_date      date,
  separation_type_id   int not null,  -- fk
  reason_for_separation text,
  supervisor_id        int,           -- fk
  is_notify_employee   boolean,
  additional_notes     text,
  separation_status_id int not null,  -- fk
  record_status_id     int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text,

  constraint fk_separation_initiation_type
    foreign key (separation_type_id)
    references onestop.separation_type(separation_type_id),

  constraint fk_separation_initiation_status
    foreign key (separation_status_id)
    references onestop.separation_status(separation_status_id)

  -- If/when your core identity table is confirmed, uncomment & adjust schema/table:
  -- ,constraint fk_separation_initiation_core_identity
  --   foreign key (core_identity_id) references <schema>.core_identity(core_identity_id)
  -- ,constraint fk_separation_initiation_supervisor
  --   foreign key (supervisor_id) references <schema>.core_identity(core_identity_id)
);

create index if not exists ix_separation_initiation_core_identity_id
  on onestop.separation_initiation(core_identity_id);

create index if not exists ix_separation_initiation_type_id
  on onestop.separation_initiation(separation_type_id);

create index if not exists ix_separation_initiation_status_id
  on onestop.separation_initiation(separation_status_id);

create index if not exists ix_separation_initiation_supervisor_id
  on onestop.separation_initiation(supervisor_id);

create table if not exists onestop.one_stop_office_separation_checklist (
  one_stop_office_separation_checklist_id int generated by default as identity primary key,

  separation_initiation_id   int not null, -- fk
  one_stop_office_id         int not null, -- fk
  one_stop_office_item_id    int not null, -- fk
  one_stop_checklist_status_id int not null, -- fk

  checklist_answer_text text,
  validation_notes      text,
  completed_by          uuid,
  completed_date        timestamp,
  validated_by          uuid,
  validated_date        timestamp,
  record_status_id      int,

  -- audit fields
  created_by       uuid,
  created_date     timestamp not null default now(),
  created_machine  text,
  modified_by      uuid,
  modified_date    timestamp,
  modified_machine text,
  deleted_by       uuid,
  deleted_date     timestamp,
  deleted_machine  text,

  constraint fk_os_checklist_initiation
    foreign key (separation_initiation_id)
    references onestop.separation_initiation(separation_initiation_id),

  constraint fk_os_checklist_office
    foreign key (one_stop_office_id)
    references onestop.one_stop_offices(one_stop_office_id),

  constraint fk_os_checklist_item
    foreign key (one_stop_office_item_id)
    references onestop.one_stop_office_items(one_stop_office_item_id),

  constraint fk_os_checklist_status
    foreign key (one_stop_checklist_status_id)
    references onestop.one_stop_checklist_statuses(one_stop_checklist_status_id)
);

create index if not exists ix_os_checklist_initiation_id
  on onestop.one_stop_office_separation_checklist(separation_initiation_id);

create index if not exists ix_os_checklist_office_id
  on onestop.one_stop_office_separation_checklist(one_stop_office_id);

create index if not exists ix_os_checklist_item_id
  on onestop.one_stop_office_separation_checklist(one_stop_office_item_id);

create index if not exists ix_os_checklist_status_id
  on onestop.one_stop_office_separation_checklist(one_stop_checklist_status_id);
