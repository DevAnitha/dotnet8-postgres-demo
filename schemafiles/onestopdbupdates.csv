create table if not exists one_stop_office_separation (
  one_stop_office_separation_id int generated by default as identity primary key,
  separation_initiation_id int not null,   
  one_stop_office_id int not null,
  validation_notes text,                   
  approved_by int,
  approved_date timestamp,
  record_status_id int,

  created_by int,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by int,
  modified_date timestamp,
  modified_machine text,
  deleted_by int,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_office_separation_office
    foreign key (one_stop_office_id) references one_stop_offices(one_stop_office_id)
constraint fk_one_stop_office_separation_initiation
 foreign key (separation_initiation_id) references separation_initiation(separation_initiation_id));
 ----------------------------
 create table if not exists one_stop_office_separation_checklist (
  one_stop_office_separation_checklist_id int generated by default as identity primary key,
  one_stop_office_separation_id int not null,
  one_stop_office_item_id int not null,
  one_stop_checklist_status_id int not null,
  checklist_answer_text text,
  completed_by int,
  completed_date timestamp,
  validated_by int,
  validated_date timestamp,
  record_status_id int,

  created_by int,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by int,
  modified_date timestamp,
  modified_machine text,
  deleted_by int,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_sep_checklist_sep
    foreign key (one_stop_office_separation_id)
      references one_stop_office_separation(one_stop_office_separation_id),

  constraint fk_one_stop_sep_checklist_item
    foreign key (one_stop_office_item_id)
      references one_stop_office_items(one_stop_office_item_id),

  constraint fk_one_stop_sep_checklist_status
    foreign key (one_stop_checklist_status_id)
      references one_stop_checklist_statuses(one_stop_checklist_status_id)
);




---------------------------------------------
---------------------------------------------
create table if not exists one_stop_request_change_issue_types (
  one_stop_request_change_issue_type_id int generated by default as identity primary key,
  issue_type_name text not null,
  one_stop_office_id int not null,
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_rc_issue_types_office
    foreign key (one_stop_office_id) references one_stop_offices(one_stop_office_id)
);

create unique index if not exists ux_one_stop_rc_issue_types_office_name
  on one_stop_request_change_issue_types(one_stop_office_id, issue_type_name);


-- 3B) one_stop_office_request_changes (parent submission)
create table if not exists one_stop_office_request_changes (
  one_stop_office_request_change_id int generated by default as identity primary key,
  one_stop_office_separation_id int not null,
  additional_notes text not null,
  requested_by int not null,
  requested_date timestamp not null default now(),
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_office_request_changes_sep
    foreign key (one_stop_office_separation_id)
      references one_stop_office_separation(one_stop_office_separation_id)
);


-- 3C) one_stop_office_request_change_checklist (bridge)
create table if not exists one_stop_office_request_change_checklist (
  one_stop_office_request_change_checklist_id int generated by default as identity primary key,
  one_stop_office_request_change_id int not null,
  one_stop_request_change_issue_type_id int not null,

 
  request_change_issue_type_status boolean null,

  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_rc_checklist_request
    foreign key (one_stop_office_request_change_id)
      references one_stop_office_request_changes(one_stop_office_request_change_id),

  constraint fk_one_stop_rc_checklist_issue_type
    foreign key (one_stop_request_change_issue_type_id)
      references one_stop_request_change_issue_types(one_stop_request_change_issue_type_id)
);

create unique index if not exists ux_one_stop_rc_checklist_request_issue
  on one_stop_office_request_change_checklist(one_stop_office_request_change_id, one_stop_request_change_issue_type_id);


/* ============================================================
   4) NOTIFICATION TEMPLATE 
   ============================================================ */

create table if not exists one_stop_notification_template (
  one_stop_notification_template_id int generated by default as identity primary key,

  -- Recommendation: treat this as a stable code; keep it unique
  template_type text not null,          -- (optional rename later: template_code)

  subject_template text not null,
  body_template text not null,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

create unique index if not exists ux_one_stop_notification_template_type
  on one_stop_notification_template(template_type);


/* ============================================================
   5) validation_notes was originally on one_stop_office_separation_checklist.
   
   ============================================================ */

alter table one_stop_office_separation_checklist
  drop column if exists validation_notes;