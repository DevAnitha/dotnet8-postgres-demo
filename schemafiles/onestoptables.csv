-- =========================================================
-- 1) one_stop_offices
-- =========================================================
create table if not exists one_stop_offices (
  one_stop_office_id int generated by default as identity primary key,
  one_stop_office_name text not null,
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

-- Optional (but usually good):
create unique index if not exists uq_one_stop_offices_name
  on one_stop_offices (lower(one_stop_office_name));

create index if not exists ix_one_stop_offices_record_status_id
  on one_stop_offices (record_status_id);
-----------------------------
-- =========================================================
-- 2) one_stop_checklist_statuses
-- =========================================================
create table if not exists one_stop_checklist_statuses (
  one_stop_checklist_status_id int generated by default as identity primary key,
  one_stop_checklist_status_code text not null,  -- e.g., PENDING/DONE/NA
  one_stop_checklist_status_name text not null,  -- e.g., Pending/Done/Not Applicable
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

-- Strongly recommended:
create unique index if not exists uq_one_stop_checklist_statuses_code
  on one_stop_checklist_statuses (upper(one_stop_checklist_status_code));

create index if not exists ix_one_stop_checklist_statuses_record_status_id
  on one_stop_checklist_statuses (record_status_id);
--------------------------------------
-- =========================================================
-- 3) one_stop_office_items
-- =========================================================
create table if not exists one_stop_office_items (
  one_stop_office_item_id int generated by default as identity primary key,
  one_stop_office_id int not null,
  one_stop_office_item_name text not null,
  control_type text not null,  -- 'radio' or 'checkbox' (per your design)
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_office_items_office
    foreign key (one_stop_office_id)
    references one_stop_offices(one_stop_office_id),

  constraint ck_one_stop_office_items_control_type
    check (control_type in ('radio', 'checkbox'))
);

create index if not exists ix_one_stop_office_items_one_stop_office_id
  on one_stop_office_items (one_stop_office_id);

create index if not exists ix_one_stop_office_items_record_status_id
  on one_stop_office_items (record_status_id);

-- Optional: prevent duplicate item names within the same office
create unique index if not exists uq_one_stop_office_items_office_item_name
  on one_stop_office_items (one_stop_office_id, lower(one_stop_office_item_name));
--------------------------------
-- =========================================================
-- 4) one_stop_office_core_checklist
--    (the transactional table storing responses/status per item)
-- =========================================================
create table if not exists one_stop_office_core_checklist (
  one_stop_office_core_checklist_id int generated by default as identity primary key,
  separation_initiation_id int not null,
  one_stop_office_item_id int not null,
  one_stop_checklist_status_id int not null,

  checklist_answer_text text,
  validation_notes text,

  completed_by uuid,
  completed_date timestamp,

  validated_by uuid,
  validated_date timestamp,

  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_one_stop_core_checklist_office_item
    foreign key (one_stop_office_item_id)
    references one_stop_office_items(one_stop_office_item_id),

  constraint fk_one_stop_core_checklist_status
    foreign key (one_stop_checklist_status_id)
    references one_stop_checklist_statuses(one_stop_checklist_status_id),

  -- FK to other team's table (assumes it exists):
  constraint fk_one_stop_core_checklist_separation_initiation
    foreign key (separation_initiation_id)
    references separation_initiation(separation_initiation_id),

  -- Prevent duplicates: 1 row per (separation initiation + item)
  constraint uq_one_stop_core_checklist_initiation_item
    unique (separation_initiation_id, one_stop_office_item_id)
);

create index if not exists ix_one_stop_core_checklist_separation_initiation_id
  on one_stop_office_core_checklist (separation_initiation_id);

create index if not exists ix_one_stop_core_checklist_one_stop_office_item_id
  on one_stop_office_core_checklist (one_stop_office_item_id);

create index if not exists ix_one_stop_core_checklist_one_stop_checklist_status_id
  on one_stop_office_core_checklist (one_stop_checklist_status_id);

create index if not exists ix_one_stop_core_checklist_record_status_id
  on one_stop_office_core_checklist (record_status_id);
