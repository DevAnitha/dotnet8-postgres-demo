-- Optional: put these in a schema
-- create schema if not exists hrapp;
-- set search_path to hrapp;

-- -------------------------------------------------------------------
-- Audit fields pattern (embedded in each table)
-- created_by uuid, created_date timestamp, created_machine text,
-- modified_by uuid, modified_date timestamp, modified_machine text,
-- deleted_by uuid, deleted_date timestamp, deleted_machine text
-- -------------------------------------------------------------------

-- 1) LOOKUPS (no dependencies)

create table if not exists separation_type (
  separation_type_id int generated by default as identity primary key,
  separation_type_name text not null,
  sort_order int,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

create table if not exists separation_status (
  separation_status_id int generated by default as identity primary key,
  separation_status_name text not null,
  sort_order int,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

create table if not exists separation_offices (
  separation_office_id int generated by default as identity primary key,
  separation_office_name text not null,
  sort_order int,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

-- 2) LOOKUPS with dependencies

create table if not exists separation_office_items (
  separation_office_item_id int generated by default as identity primary key,
  separation_office_id int not null,
  separation_office_item_name text not null,
  sort_order int,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,
  constraint fk_sep_office_items_office
    foreign key (separation_office_id) references separation_offices(separation_office_id)
);

create table if not exists separation_office_items_sublist (
  separation_office_items_sublist_id int generated by default as identity primary key,
  separation_office_item_id int not null,
  sublist_question_text text not null,
  sort_order int,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,
  constraint fk_sep_items_sublist_item
    foreign key (separation_office_item_id) references separation_office_items(separation_office_item_id)
);

-- 3) TRANSACTIONAL / CORE TABLES

create table if not exists separation_initiation (
  separation_initiation_id int generated by default as identity primary key,
  core_identity_id uuid not null,
  last_day timestamp,
  separation_date timestamp,
  separation_type_id int not null,
  reason_for_separation text,
  is_notify_employee boolean,
  is_instant_separation boolean,
  additional_notes text,
  separation_status_id int not null,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,
  constraint fk_sep_init_type
    foreign key (separation_type_id) references separation_type(separation_type_id),
  constraint fk_sep_init_status
    foreign key (separation_status_id) references separation_status(separation_status_id)
  -- If you have this table, enable it:
  -- ,constraint fk_sep_init_core_identity
  --   foreign key (core_identity_id) references core_identity(core_identity_id)
);

create table if not exists separation_offices_core_checklist (
  separation_offices_core_checklist_id int generated by default as identity primary key,
  separation_initiation_id int not null,
  separation_office_id int not null,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,
  constraint fk_sep_offices_checklist_initiation
    foreign key (separation_initiation_id) references separation_initiation(separation_initiation_id),
  constraint fk_sep_offices_checklist_office
    foreign key (separation_office_id) references separation_offices(separation_office_id),
  constraint uq_sep_offices_checklist_unique
    unique (separation_initiation_id, separation_office_id)
);

create table if not exists separation_office_item_core_checklist (
  separation_office_item_core_checklist_id int generated by default as identity primary key,
  separation_offices_core_checklist_id int not null,
  separation_office_item_id int not null,
  is_completed boolean,
  completed_date timestamp,
  completed_by uuid,
  validated_by uuid,
  validated_date timestamp,
  validation_notes text,
  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,
  constraint fk_sep_item_checklist_parent
    foreign key (separation_offices_core_checklist_id)
    references separation_offices_core_checklist(separation_offices_core_checklist_id),
  constraint fk_sep_item_checklist_item
    foreign key (separation_office_item_id)
    references separation_office_items(separation_office_item_id),
  constraint uq_sep_item_checklist_unique
    unique (separation_offices_core_checklist_id, separation_office_item_id)
);

create table if not exists separation_office_item_sublist_answer (
  separation_office_item_sublist_answer_id int generated by default as identity primary key,
  separation_office_item_core_checklist_id int not null,
  separation_office_items_sublist_id int not null,

  -- multi-type answer (as your sheet shows)
  answer_text text,
  answer_number numeric(5,2),
  answer_boolean boolean,
  answer_date timestamp,

  record_status_id int,
  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint fk_sep_sublist_answer_item_check
    foreign key (separation_office_item_core_checklist_id)
    references separation_office_item_core_checklist(separation_office_item_core_checklist_id),

  constraint fk_sep_sublist_answer_sublist
    foreign key (separation_office_items_sublist_id)
    references separation_office_items_sublist(separation_office_items_sublist_id),

  constraint uq_sep_sublist_answer_unique
    unique (separation_office_item_core_checklist_id, separation_office_items_sublist_id),

  -- Optional “only one answer type filled” rule:
  constraint chk_one_answer_type
    check (
      (case when answer_text   is not null then 1 else 0 end) +
      (case when answer_number is not null then 1 else 0 end) +
      (case when answer_boolean is not null then 1 else 0 end) +
      (case when answer_date   is not null then 1 else 0 end)
      <= 1
    )
);

-- Optional: if you DO have record_status and want FKs, add them after:
-- alter table separation_type add constraint fk_sep_type_record_status
--   foreign key (record_status_id) references record_status(record_status_id);
-- (repeat for each table that has record_status_id)
--------------------------------------------------------------------------------------------------
-- separation_type
insert into separation_type (separation_type_name, sort_order, record_status_id)
values
 ('Resignation', 1, 1),
 ('Termination', 2, 1),
 ('Retirement', 3, 1);

-- separation_status
insert into separation_status (separation_status_name, sort_order, record_status_id)
values
 ('Initiated', 1, 1),
 ('In Progress', 2, 1),
 ('Completed', 3, 1);

-- separation_offices
insert into separation_offices (separation_office_name, sort_order, record_status_id)
values
 ('HR Office', 1, 1),
 ('IT Office', 2, 1),
 ('Security', 3, 1);
