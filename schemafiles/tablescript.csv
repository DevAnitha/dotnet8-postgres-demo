create table if not exists separation_type (
  separation_type_id int generated by default as identity primary key,
  separation_type_name text not null,
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);
create table if not exists separation_status (
  separation_status_id int generated by default as identity primary key,
  separation_status_name text not null,
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);
create table if not exists checklist_statuses (
  checklist_status_id int generated by default as identity primary key,
  checklist_status_code text not null unique,   -- pending/completed/na
  checklist_status_name text not null,          -- Pending/Completed/N/A
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

-- Seed with fixed IDs so Pending is always 1
insert into checklist_statuses (checklist_status_id, checklist_status_code, checklist_status_name, sort_order)
values
  (1, 'pending',   'Pending',   1),
  (2, 'completed', 'Completed', 2),
  (3, 'na',        'N/A',       3)
on conflict (checklist_status_id) do nothing;
create table if not exists separation_offices (
  separation_office_id int generated by default as identity primary key,
  separation_office_name text not null,
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);
create table if not exists separation_office_items (
  separation_office_item_id int generated by default as identity primary key,
  separation_office_id int not null
    references separation_offices(separation_office_id),

  separation_office_item_name text not null,
  sort_order int,
  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

create index if not exists ix_sep_office_items_office
  on separation_office_items(separation_office_id);
create table if not exists separation_initiation (
  separation_initiation_id int generated by default as identity primary key,

  core_identity_id uuid,
  last_day date,
  separation_date date,

  separation_type_id int references separation_type(separation_type_id),
  reason_for_separation text,
  is_notify_employee boolean,
  is_instant_separation boolean,
  additional_notes text,
  separation_status_id int references separation_status(separation_status_id),

  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text
);

create index if not exists ix_sep_initiation_type
  on separation_initiation(separation_type_id);

create index if not exists ix_sep_initiation_status
  on separation_initiation(separation_status_id);
create table if not exists separation_office_core_checklist (
  separation_office_core_checklist_id int generated by default as identity primary key,

  separation_initiation_id int not null
    references separation_initiation(separation_initiation_id),

  separation_office_item_id int not null
    references separation_office_items(separation_office_item_id),

  checklist_status_id int not null
    references checklist_statuses(checklist_status_id)
    default 1,  -- Pending

  checklist_answer_text text,
  validation_notes text,

  completed_by uuid,
  completed_date timestamp,
  validated_by uuid,
  validated_date timestamp,

  record_status_id int,

  created_by uuid,
  created_date timestamp not null default now(),
  created_machine text,
  modified_by uuid,
  modified_date timestamp,
  modified_machine text,
  deleted_by uuid,
  deleted_date timestamp,
  deleted_machine text,

  constraint uq_sep_office_core_checklist unique (separation_initiation_id, separation_office_item_id)
);

create index if not exists ix_sep_office_core_checklist_sep
  on separation_office_core_checklist(separation_initiation_id);

create index if not exists ix_sep_office_core_checklist_item
  on separation_office_core_checklist(separation_office_item_id);

create index if not exists ix_sep_office_core_checklist_status
  on separation_office_core_checklist(checklist_status_id);
--------------------
select
  tc.constraint_name,
  kcu.column_name,
  ccu.table_name as foreign_table_name,
  ccu.column_name as foreign_column_name
from information_schema.table_constraints tc
join information_schema.key_column_usage kcu
  on tc.constraint_name = kcu.constraint_name
join information_schema.constraint_column_usage ccu
  on ccu.constraint_name = tc.constraint_name
where tc.constraint_type = 'FOREIGN KEY'
  and tc.table_schema = 'public'
  and tc.table_name = 'separation_initiation';
